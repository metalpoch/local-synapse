# API Endpoints Documentation
# Local Synapse API v1
# Base URL: http://localhost:8080 (or your configured port)

## Table of Contents
1. [Authentication Endpoints](#authentication-endpoints)
2. [System Endpoints](#system-endpoints)
3. [Ollama Chat Endpoints](#ollama-chat-endpoints)

## Authentication Endpoints

### POST /api/v1/auth/register
Register a new user account.

**Request Headers:**
```
POST /api/v1/auth/register HTTP/1.1
Host: localhost:8080
Content-Type: application/json
Content-Length: <calculated-length>
```

**Request Body:**
```json
{
    "email": "user@example.com",
    "password": "SecurePass123*",
    "confirm_password": "SecurePass123*",
    "first_name": "John",
    "last_name": "Doe"
}
```

**Response (Success - 200 OK):**
```json
{
    "id": "user-uuid-here",
    "name": "John Doe",
    "email": "user@example.com",
    "auth_provider": "local",
    "code_provider": null,
    "image_url": null,
    "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```

**Response (Error - 400 Bad Request):**
```json
{
    "error": "Error message describing the issue"
}
```

---

### POST /api/v1/auth/login
Authenticate an existing user.

**Request Headers:**
```
POST /api/v1/auth/login HTTP/1.1
Host: localhost:8080
Content-Type: application/json
Content-Length: <calculated-length>
```

**Request Body:**
```json
{
    "email": "user@example.com",
    "password": "SecurePass123*"
}
```

**Response (Success - 200 OK):**
```json
{
    "id": "user-uuid-here",
    "name": "John Doe",
    "email": "user@example.com",
    "auth_provider": "local",
    "code_provider": null,
    "image_url": null,
    "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```

**Response (Error - 400 Bad Request):**
```json
{
    "error": "Invalid credentials"
}
```

---

## System Endpoints

### GET /api/v1/system/stats
Get system metrics and statistics. **Requires authentication.**

**Request Headers:**
```
GET /api/v1/system/stats HTTP/1.1
Host: localhost:8080
Authorization: Bearer <access_token>
```

**Response (Success - 200 OK):**
```json
{
    "cpu_percent": [12.5],
    "ram": {
        "total_gb": 16,
        "used_gb": 8,
        "free_gb": 8,
        "usage_percent": 50.0
    },
    "disk": {
        "total_gb": 512,
        "used_gb": 256,
        "free_gb": 256,
        "usage_percent": 50.0
    },
    "network": {
        "bytes_sent": 123456789,
        "bytes_recv": 987654321
    },
    "timestamp": "2024-01-11T10:30:00Z"
}
```

**Response (Error - 401 Unauthorized):**
```json
{
    "error": "Missing or invalid token"
}
```

---

## Ollama Chat Endpoints

### GET /api/v1/ollama/chat
Stream chat responses from Ollama LLM. **Requires authentication.**

**Request Headers:**
```
GET /api/v1/ollama/chat?prompt=Your%20question%20here&format=plain HTTP/1.1
Host: localhost:8080
Authorization: Bearer <access_token>
```

**Query Parameters:**
- `prompt` (required): The user's question or prompt
- `format` (optional): Response format - "plain" for plain text, or omit for Server-Sent Events (SSE) format

**Example Request:**
```
GET /api/v1/ollama/chat?prompt=What%20is%20the%20capital%20of%20France%3F&format=plain HTTP/1.1
Host: localhost:8080
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

**Response Formats:**

1. **Plain Text Format** (`format=plain`):
```
[Thinking: I need to recall the capital of France...]
The capital of France is Paris.
```

2. **Server-Sent Events (SSE) Format** (default):
```
data: {"message":{"role":"assistant","content":"The","thinking":"I need to recall the capital of France..."},"done":false}

data: {"message":{"role":"assistant","content":" capital","thinking":""},"done":false}

data: {"message":{"role":"assistant","content":" of France is Paris.","thinking":""},"done":true}
```

**Response Structure (SSE format):**
```json
{
    "message": {
        "role": "assistant",
        "content": "Response text chunk",
        "thinking": "Internal reasoning (if any)",
        "tool_calls": []
    },
    "done": false
}
```

**Error Responses:**
- **400 Bad Request**: Missing 'prompt' parameter
- **401 Unauthorized**: Missing or invalid token
- **500 Internal Server Error**: Server error

---

## Authentication Notes

1. **Access Token**: Required for all endpoints except `/api/v1/auth/login` and `/api/v1/auth/register`
2. **Token Format**: Include in the `Authorization` header as `Bearer <token>`
3. **Token Lifetime**: Access tokens expire after 15 minutes
4. **Refresh Token**: Use refresh token to obtain new access tokens (refresh endpoint not shown in current implementation)

## Example cURL Commands

### Register a new user:
```bash
curl -X POST http://localhost:8080/api/v1/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "email": "test@example.com",
    "password": "TestPass123*",
    "confirm_password": "TestPass123*",
    "first_name": "Test",
    "last_name": "User"
  }'
```

### Login:
```bash
curl -X POST http://localhost:8080/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "test@example.com",
    "password": "TestPass123*"
  }'
```

### Get system stats (with token):
```bash
curl -X GET http://localhost:8080/api/v1/system/stats \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN"
```

### Chat with Ollama (plain text):
```bash
curl -X GET "http://localhost:8080/api/v1/ollama/chat?prompt=Hello%20world&format=plain" \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN"
```

### Chat with Ollama (SSE format):
```bash
curl -X GET "http://localhost:8080/api/v1/ollama/chat?prompt=Hello%20world" \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN" \
  -H "Accept: text/event-stream"
```

---

## Notes
- All endpoints are prefixed with `/api/v1/`
- The server runs on port 8080 by default (configurable via environment variables)
- JSON is used for request/response bodies unless specified otherwise
- Error responses always include an "error" field with a descriptive message

